<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GymLog Tracker NL</title>

    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Donkere modus basisstijl */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212; /* Donkere achtergrond */
            color: #e0e0e0; /* Lichtgrijze tekst */
        }
        
        /* Aangepaste scrollbar voor donkere modus */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #4338ca; /* Donkerder indigo */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        /* Fix voor input/select in donkere modus */
        input[type="date"], input[type="text"], select {
            background-color: #333333;
            color: #e0e0e0;
            border-color: #4f46e5;
        }
    </style>

    <!-- PWA METADATA - Links naar de manifest file -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#4f46e5">
    <!-- End PWA Meta Tags -->

    <!-- Load React and Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- Globale variabelen en constanten ---
        const __app_id = 'workout-tracker-pwa-host';
        const getLogsKey = (user) => `gymlog_${__app_id}_logs_${user}`;
        const getTasksKey = (user) => `gymlog_${__app_id}_tasks_${user}`;
        
        // Dagen van de week voor taken
        const BEBE_TREADMILL_DAYS = [2, 4, 6]; // Dinsdag=2, Donderdag=4, Zaterdag=6
        const DAYS_MON_SAT = [1, 2, 3, 4, 5, 6]; // Maandag t/m Zaterdag (0=Zondag is vrij)
        const USERS = ['Baba', 'Bebe'];

        // --- React Dependencies ---
        const { useState, useEffect, useMemo } = React;
        
        // --- Lucide React Icons Placeholder (Hulpmiddelen) ---
        const Calendar = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
        const CheckSquare = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>;
        const BarChart3 = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>;
        const Settings = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.44a2 2 0 0 1-2 2h-.44a2 2 0 0 0-2 2v.44a2 2 0 0 1-2 2H2v.44a2 2 0 0 0 2 2h.44a2 2 0 0 1 2 2v.44a2 2 0 0 0 2 2h.44a2 2 0 0 1 2 2v.44a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.44a2 2 0 0 1 2-2h.44a2 2 0 0 0 2-2v-.44a2 2 0 0 1 2-2h.44v-.44a2 2 0 0 0-2-2h-.44a2 2 0 0 1-2-2v-.44a2 2 0 0 0-2-2v-.44a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>;
        const Plus = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5v14"/><path d="M5 12h14"/></svg>;
        const Trash2 = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M14 4h-4"/></svg>;
        const User = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;


        // --- Helperfuncties ---
        // YYYY-MM-DD (voor opslag en input)
        const formatDate = (date) => date.toISOString().split('T')[0];
        // DD-MM-YYYY (voor weergave in de UI)
        const displayDate = (dateString) => dateString.split('-').reverse().join('-');
        
        const dateStringToDate = (dateString) => {
            const [year, month, day] = dateString.split('-').map(Number);
            return new Date(Date.UTC(year, month - 1, day));
        };
        const getMonthYear = (dateString) => {
            const date = dateStringToDate(dateString);
            const options = { year: 'numeric', month: 'long', timeZone: 'UTC' };
            return date.toLocaleDateString('nl-NL', options);
        };
        
        // Nieuwe Standaard Routines met 'reps' en Ma-Za logica
        const DEFAULT_ROUTINES = {
            Baba: [
                // Dumbbells: 20 reps (oneven dagen) | 50 reps (even dagen)
                { id: 'dbs', name: "Dumbbells", day1Target: "20 reps", day2Target: "50 reps", type: 'alternating' },
                // Treadmill: Elke dag behalve zondag
                { id: 'treadmill', name: "Loopband", day1Target: "30 minuten", day2Target: "30 minuten", type: 'dayOfWeek', days: DAYS_MON_SAT },
                // Sit-ups: Elke dag behalve zondag
                { id: 'situps', name: "Sit-ups", day1Target: "50 reps", day2Target: "50 reps", type: 'dayOfWeek', days: DAYS_MON_SAT },
                // Push-ups: Elke dag behalve zondag
                { id: 'pushups', name: "Push-ups", day1Target: "50 reps", day2Target: "50 reps", type: 'dayOfWeek', days: DAYS_MON_SAT },
            ],
            Bebe: [
                // Treadmill: Dinsdag, Donderdag, Zaterdag
                { id: 'treadmill', name: "Loopband", day1Target: "30 minuten", day2Target: "30 minuten", type: 'dayOfWeek', days: BEBE_TREADMILL_DAYS },
                // Sit-ups: Elke dag behalve zondag
                { id: 'situps', name: "Sit-ups", day1Target: "30 reps", day2Target: "30 reps", type: 'dayOfWeek', days: DAYS_MON_SAT },
            ]
        };

        // --- Task Filtering Logic (Aangepast voor simpele labels) ---
        const getTasksForDate = (dateObj, routine, currentUser) => {
            if (!routine || routine.length === 0) return [];
            const dayOfMonth = dateObj.getUTCDate();
            const dayOfWeek = dateObj.getUTCDay(); // 0=Zo, 1=Ma, ..., 6=Za
            const isDayOdd = dayOfMonth % 2 !== 0; // Dag 1 (Oneven)
            
            return routine.filter(task => {
                // Filter taken uit die niet op deze dag van de week zijn gepland
                if (task.type === 'dayOfWeek' && task.days && !task.days.includes(dayOfWeek)) {
                    return false;
                }
                return true;
            }).map(task => {
                // Bepaal de taakgrootte
                const target = task.type === 'alternating' ? 
                               (isDayOdd ? task.day1Target : task.day2Target) : 
                               task.day1Target;

                // Labels weglaten, tenzij het Loopband is voor context
                let targetDayLabel = ''; 
                
                if (task.id === 'treadmill') {
                    if (currentUser === 'Baba') {
                         targetDayLabel = ' (Ma-Za)';
                    } else if (currentUser === 'Bebe') {
                         targetDayLabel = ' (Di, Do, Za)';
                    }
                }
                
                return {
                    id: task.id,
                    name: task.name,
                    target: target,
                    targetDay: targetDayLabel,
                };
            });
        };


        // --- Hoofd App Component ---
        const App = () => {
            const [isLoading, setIsLoading] = useState(true);
            const [currentUser, setCurrentUser] = useState('Baba'); 
            const [selectedDate, setSelectedDate] = useState(formatDate(new Date()));
            const [logs, setLogs] = useState({}); 
            const [customTasks, setCustomTasks] = useState(DEFAULT_ROUTINES[currentUser]); 
            const [activeTab, setActiveTab] = useState('Vandaag'); 
            const [message, setMessage] = useState(null);

            // 1. Initial Data Load & User Switch Handler
            const loadData = (user) => {
                setIsLoading(true);
                try {
                    const storedLogs = localStorage.getItem(getLogsKey(user));
                    setLogs(storedLogs ? JSON.parse(storedLogs) : {});
                    
                    const storedTasks = localStorage.getItem(getTasksKey(user));
                    if (storedTasks) {
                        setCustomTasks(JSON.parse(storedTasks));
                    } else {
                        setCustomTasks(DEFAULT_ROUTINES[user] || []);
                    }
                    
                    setIsLoading(false);
                } catch (e) {
                    console.error(`Fout bij laden data voor ${user}:`, e);
                    setMessage({ type: 'error', text: 'Fout bij het laden van gegevens van je apparaat.' });
                    setIsLoading(false);
                }
            };
            
            // Effect om data te laden bij opstarten en bij het wisselen van gebruiker
            useEffect(() => {
                loadData(currentUser);
            }, [currentUser]); 

            // Functie om de voltooiingsstatus op te slaan
            const handleTaskToggle = (taskId, isCurrentlyCompleted) => {
                const date = selectedDate;
                const newStatus = !isCurrentlyCompleted;
                
                try {
                    const currentDayLogs = logs[date] || {};
                    
                    const updatedLogs = {
                        ...logs,
                        [date]: { ...currentDayLogs, [taskId]: newStatus }
                    };

                    localStorage.setItem(getLogsKey(currentUser), JSON.stringify(updatedLogs));
                    setLogs(updatedLogs); 

                    const taskName = currentDayTasks.find(t => t.id === taskId)?.name;
                    setMessage({ type: 'success', text: `${taskName} gemarkeerd als ${newStatus ? 'Klaar' : 'In Afwachting'}` });

                } catch (e) {
                    console.error("Fout bij opslaan taaklog:", e);
                    setMessage({ type: 'error', text: 'Fout bij het opslaan van gegevens op je apparaat.' });
                }
            };

            // Functie om de aangepaste routine op te slaan
            const saveRoutine = (tasksToSave) => {
                try {
                    localStorage.setItem(getTasksKey(currentUser), JSON.stringify(tasksToSave));
                    setCustomTasks(tasksToSave);
                    setMessage({ type: 'success', text: 'Routine succesvol opgeslagen!' });
                } catch (e) {
                    console.error("Fout bij opslaan routine:", e);
                    setMessage({ type: 'error', text: 'Fout bij het opslaan van routine op je apparaat.' });
                }
            };
            
            // Taken voor de geselecteerde dag (Nu met currentUser doorgegeven)
            const currentDayTasks = useMemo(() => {
                return getTasksForDate(dateStringToDate(selectedDate), customTasks, currentUser).map(task => ({
                    ...task,
                    isCompleted: !!logs[selectedDate]?.[task.id],
                }));
            }, [selectedDate, customTasks, logs, currentUser]);

            // Is de hele dag voltooid?
            const isDayCompleted = useMemo(() => {
                if (!currentDayTasks || currentDayTasks.length === 0) return false;
                return currentDayTasks.every(task => task.isCompleted);
            }, [currentDayTasks]);


            // Statistieken berekening
            const stats = useMemo(() => {
                // Bereken de status voor elke gelogde datum
                const dailyCompletionStatus = Object.keys(logs).reduce((acc, date) => {
                    const logEntry = logs[date];
                    // Gebruik de routine van de huidige gebruiker voor nauwkeurige stats
                    // Let op: customTasks hier is de routine van de GESELECTEERDE currentUser, wat correct is.
                    const tasksOnDate = getTasksForDate(dateStringToDate(date), customTasks, currentUser);
                    
                    const isCompleted = tasksOnDate.length > 0 && tasksOnDate.every(task => logEntry[task.id] === true);
                    acc[date] = isCompleted;
                    return acc;
                }, {});
                
                const completedDays = Object.values(dailyCompletionStatus).filter(status => status).length;

                const dates = Object.keys(dailyCompletionStatus).sort();
                let maxStreak = 0;
                let streak = 0;

                const today = formatDate(new Date());
                let tempDate = today;
                // Controleer achterwaarts vanaf vandaag voor opeenvolgende voltooide dagen
                while(dailyCompletionStatus[tempDate] === true) {
                    streak++;
                    const d = dateStringToDate(tempDate);
                    d.setUTCDate(d.getUTCDate() - 1);
                    tempDate = formatDate(d);
                }

                // Maximale Reeks berekenen
                let currentStreak = 0;
                for (let i = 0; i < dates.length; i++) {
                    const date = dates[i];
                    const isCompleted = dailyCompletionStatus[date];

                    if (isCompleted) {
                        currentStreak++;
                    } else {
                        maxStreak = Math.max(maxStreak, currentStreak);
                        currentStreak = 0;
                    }
                }
                maxStreak = Math.max(maxStreak, currentStreak);


                return {
                    completedDays,
                    currentStreak: streak,
                    maxStreak: maxStreak,
                    dailyCompletionStatus 
                };
            }, [logs, customTasks, currentUser]);


            // --- Component: UserSelector ---
            const UserSelector = () => (
                <div className="flex justify-center p-3 space-x-2 bg-[#1e1e1e] border-b border-gray-800">
                    {USERS.map(user => (
                        <button
                            key={user}
                            onClick={() => {
                                setCurrentUser(user);
                                setActiveTab('Vandaag');
                            }}
                            className={`flex items-center px-4 py-2 rounded-full font-bold transition duration-200 shadow-md ${
                                currentUser === user ? 
                                    'bg-indigo-600 text-white shadow-indigo-500/50' : 
                                    'bg-gray-700 text-gray-300 hover:bg-gray-600'
                            }`}
                        >
                            <User size={20} className="mr-2"/> {user}
                        </button>
                    ))}
                </div>
            );

            // --- Component: DateSelector ---
            const DateSelector = ({ date, setDate }) => {
                const today = formatDate(new Date());
                const maxDate = today;

                const handleChange = (e) => {
                    setDate(e.target.value);
                };

                return (
                    <div className="flex justify-center items-center my-4 px-4">
                        <input
                            type="date"
                            value={date}
                            onChange={handleChange}
                            max={maxDate}
                            className="p-3 border-4 border-indigo-600 rounded-xl shadow-lg font-mono text-lg text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150"
                        />
                    </div>
                );
            };

            // --- Component: TasksView ---
            const TasksView = () => (
                <div className="space-y-4 p-4">
                    <h2 className="text-xl font-bold text-gray-50 flex items-center justify-between">
                        {/* Gebruik displayDate voor DD-MM-YYYY weergave */}
                        <span>Trainingsdoelen voor {displayDate(selectedDate)}</span>
                        <span className={`text-sm font-semibold px-3 py-1 rounded-full shadow-inner ${
                            isDayCompleted ? 'bg-green-600 text-white' : 'bg-yellow-600 text-yellow-50'
                        }`}>
                            {isDayCompleted ? 'DAG VOLTOOID' : 'BEZIG'}
                        </span>
                    </h2>
                    <div className="bg-[#1e1e1e] p-5 rounded-xl shadow-lg border border-gray-700">
                        <ul className="space-y-3">
                            {currentDayTasks.map((task, index) => (
                                <li key={task.id} className="flex justify-between items-center py-2 border-b border-gray-700 last:border-b-0">
                                    <div className="flex items-center space-x-3">
                                        <input
                                            type="checkbox"
                                            checked={task.isCompleted}
                                            onChange={() => handleTaskToggle(task.id, task.isCompleted)}
                                            className="h-6 w-6 text-indigo-600 border-gray-500 rounded focus:ring-indigo-500 cursor-pointer bg-gray-600"
                                        />
                                        <div className="text-left">
                                            <p className="font-medium text-gray-50">{task.name}</p>
                                            {/* Geen (Dag 1), (Dagelijks), of (Specifieke dagen) meer, behalve de Loopband context */}
                                            <p className="text-sm text-gray-400">{task.target}{task.targetDay}</p>
                                        </div>
                                    </div>
                                    <span className={`font-bold text-sm px-3 py-1 rounded-full ${task.isCompleted ? 'bg-indigo-600 text-white' : 'bg-gray-700 text-gray-300'}`}>
                                        {task.isCompleted ? 'Klaar' : 'Doel'}
                                    </span>
                                </li>
                            ))}
                        </ul>
                    </div>
                    {currentDayTasks.length === 0 && (
                        <div className="text-center p-8 bg-indigo-900 rounded-xl text-indigo-200 font-medium border border-indigo-800">
                            Geen taken gepland voor vandaag ({displayDate(selectedDate)}).
                        </div>
                    )}
                </div>
            );

            // --- Component: HistoryView ---
            const HistoryView = () => {
                const today = new Date();
                const oneYearAgo = new Date(today);
                oneYearAgo.setDate(today.getDate() - 364);

                let dateArray = [];
                let currentDate = new Date(oneYearAgo);

                while (currentDate.getTime() <= today.getTime()) {
                    dateArray.push(formatDate(currentDate));
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                // Groep data per Maand/Jaar en toon nieuwste data bovenaan
                const groupedDates = dateArray.reverse().reduce((acc, dateString) => {
                    const monthYear = getMonthYear(dateString);
                    if (!acc[monthYear]) {
                        acc[monthYear] = [];
                    }
                    acc[monthYear].push(dateString);
                    return acc;
                }, {});

                const Cell = ({ dateString }) => {
                    const isDayCompleted = stats.dailyCompletionStatus[dateString] === true;
                    const date = dateStringToDate(dateString).getUTCDate();
                    const isToday = dateString === formatDate(new Date());

                    return (
                        <div
                            title={displayDate(dateString) + (isDayCompleted ? ' (Voltooid)' : ' (In Afwachting)')}
                            onClick={() => {
                                setSelectedDate(dateString);
                                setActiveTab('Vandaag');
                            }}
                            className={`h-10 w-10 sm:h-12 sm:w-12 flex items-center justify-center rounded-lg transition-all duration-150 cursor-pointer text-sm font-semibold
                                ${isToday ? 'border-4 border-indigo-500 bg-indigo-900 text-indigo-200 font-extrabold shadow-inner shadow-indigo-500' : ''}
                                ${isDayCompleted && !isToday ? 'bg-green-700 text-white hover:bg-green-600 shadow-md' : ''}
                                ${!isDayCompleted && !isToday ? 'bg-gray-700 text-gray-400 hover:bg-gray-600 shadow-md' : ''}
                            `}
                        >
                            {date}
                        </div>
                    );
                };

                return (
                    <div className="p-4 space-y-6">
                        <h2 className="text-2xl font-bold text-gray-50 mb-4">1-Jaar Geschiedenis van {currentUser}</h2>
                        <div className="grid grid-cols-7 gap-1 sm:gap-2 text-center font-semibold text-xs sm:text-sm text-indigo-400 bg-[#1e1e1e] p-2 rounded-lg shadow-inner">
                            {['Zo', 'Ma', 'Di', 'Wo', 'Do', 'Vr', 'Za'].map(day => (
                                <div key={day}>{day}</div>
                            ))}
                        </div>

                        {/* Weergeeft maanden van NIEUW naar OUD */}
                        {Object.entries(groupedDates).map(([monthYear, dates]) => (
                            <div key={monthYear}>
                                <h3 className="text-lg font-bold text-indigo-400 my-3 border-b border-indigo-900 pb-1">{monthYear}</h3>
                                <div className="grid grid-cols-7 gap-1 sm:gap-2">
                                    {/* Padding voor de eerste dag van de maand */}
                                    {Array.from({ length: dateStringToDate(dates[dates.length - 1]).getUTCDay() }).map((_, i) => (
                                        <div key={`pad-${i}`} className="h-10 w-10 sm:h-12 sm:w-12"></div>
                                    ))}
                                    {/* Dagen van OUD naar NIEUW, zodat de maand onderaan vol is */}
                                    {dates.reverse().map(dateString => (
                                        <Cell key={dateString} dateString={dateString} />
                                    ))}
                                </div>
                            </div>
                        ))}

                        <div className="mt-6 p-4 bg-[#1e1e1e] rounded-xl shadow-lg border border-gray-700">
                            <p className="font-semibold text-gray-300">Dagen Gevolgd: <span className="text-indigo-400">{dateArray.length}</span></p>
                            <p className="font-semibold text-gray-300">Voltooide Dagen: <span className="text-green-500">{stats.completedDays}</span></p>
                        </div>
                    </div>
                );
            };

            // --- Component: StatCard ---
            const StatCard = ({ title, value, color }) => (
                <div className={`p-4 rounded-xl shadow-lg border border-gray-700 ${color}`}>
                    <p className="text-3xl font-extrabold">{value}</p>
                    <p className="text-sm font-medium mt-1">{title}</p>
                </div>
            );

            // --- Component: StatsView ---
            const StatsView = () => (
                <div className="p-4 space-y-6">
                    <h2 className="text-2xl font-bold text-gray-50 mb-4">Jouw Vooruitgang ({currentUser})</h2>

                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <StatCard title="Voltooide Dagen" value={stats.completedDays} color="bg-green-900/50 text-green-300" />
                        <StatCard title="Huidige Reeks" value={stats.currentStreak} color="bg-yellow-900/50 text-yellow-300" />
                        <StatCard title="Maximale Reeks" value={stats.maxStreak} color="bg-red-900/50 text-red-300" />
                    </div>

                    <div className="bg-[#1e1e1e] p-5 rounded-xl shadow-lg border border-indigo-900">
                        <h3 className="font-bold text-lg text-indigo-400">App Status</h3>
                        <ul className="mt-2 space-y-2 text-gray-400">
                            <li className="flex items-center">
                                <CheckSquare className="h-5 w-5 text-green-500 mr-2"/>
                                Gegevens worden nu **lokaal** opgeslagen. Geen cloudopslag nodig!
                            </li>
                            <li className="flex items-center">
                                <Settings className="h-5 w-5 text-indigo-500 mr-2"/>
                                Gebruik het tabblad **Routines** om je taken aan te passen.
                            </li>
                        </ul>
                    </div>
                </div>
            );

            // --- Component: RoutinesView ---
            const RoutinesView = () => {
                const [newTask, setNewTask] = useState({ id: '', name: '', day1Target: '', day2Target: '', type: 'dayOfWeek' });

                const generateId = (name) => name.toLowerCase().replace(/[^a-z0-9]/g, '').slice(0, 10) + '_' + Date.now().toString().slice(-4);

                const handleAddTask = (e) => {
                    e.preventDefault();
                    if (!newTask.name || !newTask.day1Target || (newTask.type === 'alternating' && !newTask.day2Target)) {
                        setMessage({ type: 'error', text: 'Vul alle verplichte velden in voor de nieuwe taak.' });
                        return;
                    }

                    // Voorbeeldlogica om de standaarddagen in te stellen als de gebruiker een type selecteert
                    let daysToAssign = [];
                    if (newTask.type === 'dayOfWeek') {
                         // Dit vereenvoudigt het formulier niet, maar is veiliger voor opslag
                         // In dit voorbeeld gebruiken we de default Ma-Za om te starten
                         daysToAssign = DAYS_MON_SAT; 
                    } else if (newTask.type === 'daily') {
                         daysToAssign = DAYS_MON_SAT;
                    }


                    const taskToAdd = {
                        ...newTask,
                        id: generateId(newTask.name),
                        // Voor nieuwe taken: als 'daily' of 'dayOfWeek', gebruiken we Ma-Za, 
                        // behalve voor specifieke gevallen zoals Bebe's Loopband die je handmatig moet toevoegen.
                        type: newTask.type === 'daily' ? 'dayOfWeek' : newTask.type,
                        days: daysToAssign,
                        // Fix voor 'reps' indien niet ingevuld
                        day1Target: newTask.day1Target.includes('herhalingen') ? newTask.day1Target.replace('herhalingen', 'reps') : newTask.day1Target,
                        day2Target: newTask.day2Target.includes('herhalingen') ? newTask.day2Target.replace('herhalingen', 'reps') : newTask.day2Target,
                    };


                    const updatedTasks = [...customTasks, taskToAdd];
                    saveRoutine(updatedTasks);
                    setNewTask({ id: '', name: '', day1Target: '', day2Target: '', type: 'dayOfWeek' }); // Reset form
                };

                const handleDeleteTask = (taskId) => {
                    const updatedTasks = customTasks.filter(task => task.id !== taskId);
                    saveRoutine(updatedTasks);
                };

                return (
                    <div className="p-4 space-y-6">
                        <h2 className="text-2xl font-bold text-gray-50">Jouw Aangepaste Routine ({currentUser})</h2>

                        {/* Task List */}
                        <div className="bg-[#1e1e1e] p-5 rounded-xl shadow-lg space-y-3 border border-gray-700">
                            <h3 className="font-bold text-lg text-indigo-400 border-b border-gray-700 pb-2">Actieve Taken ({customTasks.length})</h3>
                            {customTasks.map(task => {
                                const daysText = task.type === 'alternating' ? 'Oneven/Even' : 
                                                 (task.days && task.days.length === DAYS_MON_SAT.length ? 'Maandag-Zaterdag' : 
                                                 (task.days && task.days.includes(2) ? 'Di, Do, Za' : 'Specifieke Dagen'));

                                return (
                                    <div key={task.id} className="flex justify-between items-center bg-gray-800 p-3 rounded-lg border border-gray-700">
                                        <div className="flex-grow">
                                            <p className="font-medium text-gray-50">{task.name}</p>
                                            <p className="text-xs text-gray-400">
                                                {daysText}: {task.type === 'alternating' ? `Dag 1: ${task.day1Target} / Dag 2: ${task.day2Target}` : task.day1Target}
                                            </p>
                                        </div>
                                        <button
                                            onClick={() => handleDeleteTask(task.id)}
                                            className="p-2 ml-4 text-red-400 hover:text-red-300 transition duration-150 rounded-full bg-red-900/50"
                                        >
                                            <Trash2 size={18} />
                                        </button>
                                    </div>
                                );
                            })}
                            {customTasks.length === 0 && <p className="text-gray-500 italic">Nog geen taken gedefinieerd.</p>}
                        </div>

                        {/* Add New Task Form */}
                        <div className="bg-indigo-900/30 p-5 rounded-xl shadow-lg border-2 border-indigo-900">
                            <h3 className="font-bold text-lg text-indigo-400 mb-4 flex items-center"><Plus size={20} className="mr-2"/> Nieuwe Taak Toevoegen</h3>
                            <form onSubmit={handleAddTask} className="space-y-3">
                                <input
                                    type="text"
                                    placeholder="Taaknaam (bv. Roeien)"
                                    value={newTask.name}
                                    onChange={(e) => setNewTask({ ...newTask, name: e.target.value })}
                                    className="w-full p-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                    required
                                />
                                <select
                                    value={newTask.type}
                                    onChange={(e) => setNewTask({ ...newTask, type: e.target.value })}
                                    className="w-full p-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                >
                                    <option value="dayOfWeek">Elke dag behalve Zondag</option>
                                    <option value="alternating">Wisselend (Dag 1 / Dag 2)</option>
                                </select>

                                <input
                                    type="text"
                                    placeholder={`Doel Dag 1 (bv. 3 sets van 10 reps)`}
                                    value={newTask.day1Target}
                                    onChange={(e) => setNewTask({ ...newTask, day1Target: e.target.value })}
                                    className="w-full p-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                    required
                                />

                                {newTask.type === 'alternating' && (
                                    <input
                                        type="text"
                                        placeholder={"Doel Dag 2 (bv. 2 sets van 12 reps)"}
                                        value={newTask.day2Target}
                                        onChange={(e) => setNewTask({ ...newTask, day2Target: e.target.value })}
                                        className="w-full p-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                        required
                                    />
                                )}

                                <button
                                    type="submit"
                                    className="w-full p-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition duration-200 shadow-lg"
                                >
                                    Taak aan Routine Toevoegen
                                </button>
                            </form>
                        </div>
                    </div>
                );
            };

            // --- Component: TabButton ---
            const TabButton = ({ label, icon: Icon, tabName }) => (
                <button
                    onClick={() => setActiveTab(tabName)}
                    className={`flex flex-col items-center justify-center p-2 flex-grow transition-all duration-200 ${
                        activeTab === tabName ? 'text-indigo-400 border-t-2 border-indigo-400 bg-gray-800 shadow-inner' : 'text-gray-500 hover:text-indigo-400'
                    }`}
                >
                    <Icon size={20} />
                    <span className="text-xs mt-1 font-medium hidden sm:block">{label}</span>
                </button>
            );

            if (isLoading) {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen bg-[#121212] p-4">
                        <p className="text-gray-400 font-medium">Laden van lokale gegevens...</p>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-[#121212] flex flex-col items-center">
                    {/* Header */}
                    <div className="w-full max-w-lg bg-[#1e1e1e] shadow-lg p-3 flex justify-between items-center border-b border-gray-800">
                        <h1 className="text-2xl font-extrabold text-indigo-400">GymLog</h1>
                        <span className="text-sm text-gray-400 px-3 py-1 rounded-full bg-indigo-900/30 font-medium border border-indigo-900">Offline Klaar</span>
                    </div>

                    <UserSelector />

                    <main className="w-full max-w-lg flex-grow">
                        {message && (
                            <div className={`p-3 text-center font-medium ${message.type === 'success' ? 'bg-green-900/50 text-green-300' : 'bg-red-900/50 text-red-300'}`}>
                                {message.text}
                            </div>
                        )}

                        {activeTab === 'Vandaag' && (
                            <>
                                <DateSelector date={selectedDate} setDate={setSelectedDate} />
                                <TasksView />
                            </>
                        )}
                        {activeTab === 'Geschiedenis' && <HistoryView />}
                        {activeTab === 'Statistieken' && <StatsView />}
                        {activeTab === 'Routines' && <RoutinesView />}

                        {/* Padding to push content up */}
                        <div className="h-20"></div>
                    </main>

                    {/* Mobile Tab Bar */}
                    <div className="fixed bottom-0 w-full max-w-lg bg-[#1e1e1e] border-t border-gray-800 shadow-2xl flex justify-around h-14 z-10">
                        <TabButton label="Vandaag" icon={CheckSquare} tabName="Vandaag" />
                        <TabButton label="Geschiedenis" icon={Calendar} tabName="Geschiedenis" />
                        <TabButton label="Statistieken" icon={BarChart3} tabName="Statistieken" />
                        <TabButton label="Routines" icon={Settings} tabName="Routines" />
                    </div>
                </div>
            );
        }

        // Mount the App component
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
